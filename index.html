<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>reCAPTCHA v3 Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>
  <!-- Basically blank â€“ just a tiny bit of debug output -->
  <h1 style="font-size: 18px; font-weight: normal;">
    reCAPTCHA v3 Test (page load)
  </h1>
  <p>Token (for debugging only):</p>
  <pre id="recaptcha-token" style="word-wrap: break-word; white-space: pre-wrap;"></pre>

  <p>Score:</p>
  <pre id="recaptcha-score"></pre>

  <!-- Load reCAPTCHA v3 with your site key -->
  <script src="https://www.google.com/recaptcha/api.js?render=6LeUQCIsAAAAANlCtMbYv4fLleOcqlEkmAISnavW"></script>


<script>
  const BACKEND_URL = 'https://eoi963iw82fgjx4.m.pipedream.net';

  window.addEventListener('load', function () {
    grecaptcha.ready(function () {
      grecaptcha.execute('6LeUQCIsAAAAANlCtMbYv4fLleOcqlEkmAISnavW', { action: 'page_load' })
        .then(function (token) {
          // Show token on page
          const tokenEl = document.getElementById('recaptcha-token');
          if (tokenEl) tokenEl.textContent = token;

          // Send token to backend to get the score
          fetch(BACKEND_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token, action: 'page_load' })
          })
          .then(res => res.json())
          .then(data => {
            console.log('Verify response:', data);
            const scoreEl = document.getElementById('recaptcha-score');
            if (scoreEl) {
              if (data && typeof data.score === 'number') {
                scoreEl.textContent = data.score;
              } else {
                scoreEl.textContent = 'No score returned';
              }
            }
          })
          .catch(err => {
            console.error('Error verifying reCAPTCHA:', err);
          });
        });
    });
  });
</script>

</body>
</html>
